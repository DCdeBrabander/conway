"use strict";(()=>{var E=class{constructor(e,t,i){this.x=0;this.y=0;this.size=0;this.example=!1;this.alive=!0;this.aliveNeighbours=0;this.setAliveNeighbours=e=>this.aliveNeighbours=e;this.x=e,this.y=t,this.alive=i}},m=E;var K=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],b=K;var q=[[0,1,0,1,0,0],[1,0,0,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1]],P=q;var W=[[1,1,1]],L=W;var Z=[[1]],N=Z;var Y=[[1,1,0,0],[0,1,0,0],[0,1,0,1],[0,0,1,1]],_=Y;var j=[[0,1,0],[0,0,1],[1,1,1]],T=j;var V=[[1,0,0],[1,1,1],[1,0,1],[0,0,1]],x=V;var J=[[0,0,1,1,1,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[0,0,1,1,1,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,1,1,1,0,0],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,1,1,1,0,0]],z=J;var h=(o=>(o.CELL="Cell",o.BLINKER="Blinker",o.GLIDER="Glider",o.PULSAR="Pulsar",o.EATER="Eater",o.SWITCH_ENGINE="SwitchEngine",o.GLIDER_GUN="GliderGun",o.HERSCHEL="Herschel",o))(h||{}),y=a=>{switch(a){case"Cell":return N;case"Blinker":return L;case"Glider":return T;case"Pulsar":return z;case"Eater":return _;case"SwitchEngine":return P;case"GliderGun":return b;case"Herschel":return x;default:return console.warn("unsupported pattern requested: "+a),[]}};var d=(i=>(i[i.PAUSED=0]="PAUSED",i[i.RUNNING=1]="RUNNING",i[i.SINGLE_TICK=2]="SINGLE_TICK",i))(d||{}),g=class{constructor(e,t=10,i=10){this.canvasElement=e;this._cellSize=t;this._fps=i;this.MAX_FPS=60;this.MAX_CELL_SIZE=100;this.realFrameTime=0;this._allowTick=!0;this.theme={grid:"#888",cell:{alive:"#FFF",example:"#AAA"},background:"#222"};this.grid=[];this.previewCells=[];this.currentState=0;this.currentPreviewPattern="Cell";this.previousCanvasSize={width:0,height:0};this.heightOffset=0;this.init=()=>(this.setGameState(0),this.setCanvasSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",this._onResize,!1),this.grid=this._getNewGrid(),this.gameLoop(),this);this.gameLoop=()=>{let e=performance.timeOrigin+performance.now();switch(this.currentState){case 1:this.run();break;case 0:this.paused();break;case 2:this.tick();break}this.realFrameTime=performance.timeOrigin+performance.now()-e,setTimeout(()=>{requestAnimationFrame(this.gameLoop)},1e3/this.fps)};this.tick=()=>{this.draw(),this._allowTick&&(this.run(),this._allowTick=!1)};this.paused=()=>{this.draw()};this.run=()=>{this.update(),this.draw()};this.draw=()=>{this._clear(),this._drawPreviewCells(),this._drawLivingCells(),this._drawGrid()};this.fullUpdate=()=>{let e=this._getNewGrid();this.grid.forEach((t,i)=>{t.forEach((r,s)=>{r.setAliveNeighbours(this.countAliveNeighboursForCell(r)),e[i][s].alive=this.isCellStillAlive(r)})}),this.grid=e};this.update=()=>{let e=this._findRelevantCellsForUpdate(),t=this._getNewGrid();e.forEach((i,r)=>{i.forEach((s,l)=>{this.grid[r][l].setAliveNeighbours(this.countAliveNeighboursForCell(s)),t[r][l].alive=this.isCellStillAlive(this.grid[r][l])})}),this.grid=t};this._clear=()=>{this.canvasContext.fillStyle=this.theme.background,this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.canvasContext.fillRect(0,0,this.canvasElement.width,this.canvasElement.height)};this._drawGrid=()=>{this.canvasContext.strokeStyle=this.theme.grid,this.grid.forEach(e=>{e.forEach((t,i)=>{this.canvasContext.strokeRect(t.x,t.y,this.cellSize,this.cellSize)})})};this._drawPreviewCells=()=>{this.previewCells.forEach(e=>{e.forEach(t=>this._drawCell(t))})};this._drawLivingCells=()=>{this.grid.forEach(e=>{e.forEach(t=>this._drawCell(t))})};this._drawCell=e=>{if(e.alive)this.canvasContext.fillStyle=this.theme.cell.alive;else if(e.example)this.canvasContext.fillStyle=this.theme.cell.example;else return;this.canvasContext.fillRect(e.x,e.y,this.cellSize,this.cellSize)};this._onResize=()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.setCanvasSize(window.innerWidth,window.innerHeight),this._resizeGrid(),console.info("canvas resized: grid updated accordingly")},100)};this._findRelevantCellsForUpdate=()=>{let e=[];return this.grid.forEach((t,i)=>{t.forEach((r,s)=>{if(r.alive){for(let l of this.getAllCellNeighbourCoordinates(r))e[l.x]||(e[l.x]=[]),e[l.x][l.y]||(e[l.x][l.y]=this._getCellAt(l.x,l.y));e[i][s]=r}})}),e};this._getNewGrid=()=>{let e=[];for(let t=0;t<=this.canvasElement?.width;t+=this.cellSize){e[t]=[];for(let i=0;i<=this.canvasElement?.height;i+=this.cellSize)e[t][i]=new m(t,i,!1)}return e};this._resizeGrid=()=>{let e=this.grid,t=this.canvasElement.width>this.previousCanvasSize.width,i=this.canvasElement.height>this.previousCanvasSize.height;if(t||i){for(let r=0;r<=this.canvasElement?.width;r+=this.cellSize)for(let s=0;s<=this.canvasElement?.height;s+=this.cellSize)typeof e[r]>"u"&&(e[r]=[]),typeof e[r][s]>"u"&&(e[r][s]=new m(r,s,!1));console.info("Increased size of grid")}else{e:for(let r=this.previousCanvasSize.height;r>=0;r-=this.cellSize)for(let s=this.previousCanvasSize.width;s>=0;s-=this.cellSize)if(this.canvasElement.height<r)delete e[s][r];else if(this.canvasElement.width<s)delete e[s];else break e;console.info("Decreased size of grid")}this.grid=e};this._getCellAt=(e,t)=>this.grid[e][t];this._overflowPosition=(e,t)=>{let i={x:e,y:t},{width:r,height:s}=this.canvasElement;return e<0?i.x=r-this.cellSize:e>=r&&(i.x=0),t<0?i.y=s-this.cellSize:t>=s&&(i.y=0),i};this.getRealFrameTime=()=>this.realFrameTime;this.getSupportedPatterns=()=>Object.keys(h);this.getCurrentPreviewPattern=()=>this.currentPreviewPattern;this.setCurrentPreviewPattern=e=>(this.currentPreviewPattern=e,this);this.setHeightOffset=e=>(this.heightOffset=e,this);this.setCanvasSize=(e,t)=>{this.previousCanvasSize={width:this.canvasElement.width,height:this.canvasElement.height};let i=this.roundToNearest(e),r=this.roundToNearest(t-this.heightOffset);return this.canvasElement.style.width=i+"px",this.canvasElement.style.height=r+"px",this.canvasElement.width=i,this.canvasElement.height=r,this};this.setGameState=e=>(this.currentState=e,this);this.isCellStillAlive=e=>{let t=e.alive;return e.aliveNeighbours=this.countAliveNeighboursForCell(e),e.alive?e.aliveNeighbours===2||e.aliveNeighbours===3?t=!0:t=!1:e.aliveNeighbours===3&&(t=!0),t};this.countAliveNeighboursForCell=e=>{let t=0,i=this.getAllCellNeighbourCoordinates(e);for(let r of i)this._getCellAt(r.x,r.y).alive&&t++;return t};this.getAllCellNeighbourCoordinates=e=>{let{x:t,y:i}=e;return[this._overflowPosition(t-this.cellSize,i-this.cellSize),this._overflowPosition(t,i-this.cellSize),this._overflowPosition(t+this.cellSize,i-this.cellSize),this._overflowPosition(t-this.cellSize,i),this._overflowPosition(t+this.cellSize,i),this._overflowPosition(t-this.cellSize,i+this.cellSize),this._overflowPosition(t,i+this.cellSize),this._overflowPosition(t+this.cellSize,i+this.cellSize)]};this.roundToNearest=(e,t=this.cellSize)=>Math.floor(e/t)*t;this.showPattern=(e,t,i,r=!1)=>{let s=y(e),l=[];r?(this.previewCells=this._getNewGrid(),l=this.previewCells):l=this.grid;let U=Math.floor(s[0].length/2),o=Math.floor(s.length/2);s.forEach((B,D)=>{B.forEach((O,X)=>{let c=this.roundToNearest((X-U)*this.cellSize+t),u=this.roundToNearest((D-o)*this.cellSize+i);if(typeof l[c][u]>"u"||!l[c][u]||!O)return;let w=new m(c,u,!r);w.example=r,l[c][u]=w})})};this.showPatternPreview=(e,t,i)=>this.showPattern(e,t,i,!0);this.resetPatternPreview=()=>this.previewCells=this._getNewGrid();this.toggleCellAtCoordinate=(e,t)=>{let i=this.roundToNearest(e),r=this.roundToNearest(t),s=this._getCellAt(i,r);return this._getCellAt(i,r)?(s.alive=!s.alive,this):this};return this.canvasElement=e,this.canvasContext=this.canvasElement.getContext("2d"),this.resizeTimeout=setTimeout(()=>{}),this}get fps(){return this._fps}set fps(e){e>this.MAX_FPS?(console.info("Maximum FPS reached: "+this.MAX_FPS),this._fps=this.MAX_FPS):this._fps=e}get cellSize(){return this._cellSize}set cellSize(e){e>this.MAX_CELL_SIZE?(console.info("Maximum Cell Size reached: "+this.MAX_CELL_SIZE),this._cellSize=this.MAX_CELL_SIZE):this._cellSize=e}get allowTick(){return this._allowTick}set allowTick(e){this._allowTick=e}},G=g;var A,v,C,H,f,p,I,k=()=>{p=document.getElementById("control-play"),I=document.getElementById("control-tick"),A=document.querySelector("#state span"),v=document.getElementById("help"),C=document.querySelector("#fps #target span"),H=document.querySelector("#fps #actual span"),f=document.querySelector("#patterns select"),f.addEventListener("change",()=>{let a=f.value,e=h[a]??"Cell";n.setCurrentPreviewPattern(e)}),Q(),$(),ee(),te(),R(),S()},Q=()=>{I.onclick=()=>{n.allowTick=!0,n.setGameState(2)},p.onclick=()=>{n.currentState==1?n.setGameState(0):n.setGameState(1),S()}},$=()=>{n.canvasElement.addEventListener("mousedown",a=>{let{x:e,y:t}=M(a,n.canvasElement);n.showPattern(n.getCurrentPreviewPattern(),e,t)},!1),n.canvasElement.addEventListener("mousemove",a=>{let{x:e,y:t}=M(a,n.canvasElement);n.showPatternPreview(n.getCurrentPreviewPattern(),e,t)},!1),n.canvasElement.addEventListener("mouseleave",a=>{n.resetPatternPreview()},!1)},ee=()=>{window.addEventListener("keyup",a=>{switch(a.key.toLowerCase()){case"p":n.setGameState(0);break;case"h":v.open?v.close():v.showModal();break;case" ":n.setGameState(n.currentState==1?0:1);break;default:break}S()},!1)},te=()=>n.getSupportedPatterns().forEach((a,e)=>{let t=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase();f.add(new Option(t,a,e==0))}),R=()=>{H.innerHTML=n.currentState==1?Math.floor(1e3/n.getRealFrameTime()).toString():"0",setTimeout(R,100)},S=()=>{let a=Object.keys(d)[Object.values(d).indexOf(n.currentState)];document.title="Conway's Game of Life - "+a,A.innerHTML=a,n.currentState==1?(p.innerText="|| Pause",C.innerHTML=n.fps.toString()):(p.innerText="> Play",C.innerHTML="0")},M=(a,e)=>({x:a.clientX-e.offsetLeft,y:a.clientY-e.offsetTop});var n,F,ie=()=>{F=document.getElementById("conway-canvas");let a=15,e=20;n=new G(F,a,e).setHeightOffset(document.querySelector("#info")?.clientHeight??0).init(),k()};document.addEventListener("DOMContentLoaded",()=>ie());})();
