"use strict";(()=>{var C=class{constructor(e,t,i){this.x=0;this.y=0;this.size=0;this.example=!1;this.alive=!0;this.aliveNeighbours=0;this.setAliveNeighbours=e=>this.aliveNeighbours=e;this.x=e,this.y=t,this.alive=i}},w=C;var N=[[1,1,1]],E=N;var T=[[1]],S=T;var A=[[0,1,0],[0,0,1],[1,1,1]],P=A;var M=[[0,0,1,1,1,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[0,0,1,1,1,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,1,1,1,0,0],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,1,1,1,0,0]],L=M;var m=(r=>(r.CELL="Cell",r.BLINKER="Blinker",r.GLIDER="Glider",r.PULSAR="Pulsar",r))(m||{}),x=c=>{switch(c){case"Cell":return S;case"Blinker":return E;case"Glider":return P;case"Pulsar":return L;default:return[]}};var p=(t=>(t[t.PAUSED=0]="PAUSED",t[t.RUNNING=1]="RUNNING",t))(p||{}),g=class{constructor(e,t=10,i=10){this._cellSize=t;this._fps=i;this.MAX_FPS=60;this.MAX_CELL_SIZE=100;this.realFrameTime=0;this.theme={grid:"#888",cell:{alive:"#FFF",example:"#AAA"},background:"#222"};this.grid=[];this.previewCells=[];this.currentState=0;this.currentPreviewPattern="Cell";this.heightOffset=0;this.init=()=>(this.setGameState(0),this.setCanvasSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",this.onResize,!1),this.grid=this.getNewGrid(),requestAnimationFrame(this.draw),this);this.draw=()=>{this.clear();let e=performance.timeOrigin+performance.now();this.currentState==1&&this.update(),this.drawPreviewCells(),this.drawLivingCells(),this.drawGrid(),this.realFrameTime=performance.timeOrigin+performance.now()-e,setTimeout(()=>{requestAnimationFrame(this.draw)},1e3/this.fps)};this.update=()=>{let e=this.getNewGrid();this.grid.forEach((t,i)=>{t.forEach((r,s)=>{r.setAliveNeighbours(this.countAliveNeighboursForCell(r)),e[i][s].alive=this.isCellStillAlive(r)})}),this.grid=e};this.clear=()=>{this.canvasContext.fillStyle=this.theme.background,this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.canvasContext.fillRect(0,0,this.canvasElement.width,this.canvasElement.height)};this.onResize=()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.setCanvasSize(window.innerWidth,window.innerHeight),this.init(),console.info("canvas resized and reinitialized")},100)};this.getNewGrid=()=>{let e=[];for(let t=0;t<=this.canvasElement?.width;t+=this.cellSize){e[t]=[];for(let i=0;i<=this.canvasElement?.height;i+=this.cellSize)e[t][i]=new w(t,i,!1)}return e};this.drawGrid=()=>{this.canvasContext.strokeStyle=this.theme.grid,this.grid.forEach(e=>{e.forEach((t,i)=>{this.canvasContext.strokeRect(t.x,t.y,this.cellSize,this.cellSize)})})};this.drawPreviewCells=()=>this.previewCells.forEach(e=>e.forEach((t,i)=>this.drawCell(t)));this.drawLivingCells=()=>this.grid.forEach(e=>e.forEach((t,i)=>this.drawCell(t)));this.drawCell=e=>{if(e.alive)this.canvasContext.fillStyle=this.theme.cell.alive;else if(e.example)this.canvasContext.fillStyle=this.theme.cell.example;else return;this.canvasContext.fillRect(e.x,e.y,this.cellSize,this.cellSize)};this.getCellAt=(e,t)=>this.grid[e][t];this.overflowPosition=(e,t)=>{let i={x:e,y:t},{width:r,height:s}=this.canvasElement;return e<0?i.x=r-this.cellSize:e>=r&&(i.x=0),t<0?i.y=s-this.cellSize:t>=s&&(i.y=0),i};this.getRealFrameTime=()=>this.realFrameTime;this.getSupportedPatterns=()=>Object.keys(m);this.getCurrentPreviewPattern=()=>this.currentPreviewPattern;this.setCurrentPreviewPattern=e=>(this.currentPreviewPattern=e,this);this.setHeightOffset=e=>(this.heightOffset=e,this);this.setCanvasSize=(e,t)=>{let i=this.roundToNearest(e),r=this.roundToNearest(t-this.heightOffset);return this.canvasElement.style.width=i+"px",this.canvasElement.style.height=r+"px",this.canvasElement.width=i,this.canvasElement.height=r,this};this.setGameState=e=>(this.currentState=e,this);this.isCellStillAlive=e=>{let t=e.alive;return e.aliveNeighbours=this.countAliveNeighboursForCell(e),e.alive?e.aliveNeighbours===2||e.aliveNeighbours===3?t=!0:t=!1:e.aliveNeighbours===3&&(t=!0),t};this.toggleCellAtCoordinate=(e,t)=>{let i=this.roundToNearest(e),r=this.roundToNearest(t),s=this.getCellAt(i,r);return this.getCellAt(i,r)?(s.alive=!s.alive,this):this};this.countAliveNeighboursForCell=e=>{let t=0,i=this.cellSize,{x:r,y:s}=e,u=[this.overflowPosition(r-i,s-i),this.overflowPosition(r,s-i),this.overflowPosition(r+i,s-i),this.overflowPosition(r-i,s),this.overflowPosition(r+i,s),this.overflowPosition(r-i,s+i),this.overflowPosition(r,s+i),this.overflowPosition(r+i,s+i)];for(let o of u)this.getCellAt(o.x,o.y).alive&&t++;return t};this.roundToNearest=(e,t=this.cellSize)=>Math.floor(e/t)*t;this.showPattern=(e,t,i,r=!1)=>{let s=x(e),u=[];r?(this.previewCells=this.getNewGrid(),u=this.previewCells):u=this.grid;let o=Math.floor(s[0].length/2),a=Math.floor(s.length/2);s.forEach((f,d)=>{f.forEach((n,h)=>{let l=this.roundToNearest((h-o)*this.cellSize+t),v=this.roundToNearest((d-a)*this.cellSize+i);if(typeof u[l][v]>"u"||!u[l][v]||!n)return;let b=new w(l,v,!r);b.example=r,u[l][v]=b})})};this.showPatternPreview=(e,t,i)=>{this.showPattern(e,t,i,!0)};return this.canvasElement=e,this.canvasContext=this.canvasElement.getContext("2d"),this.resizeTimeout=setTimeout(()=>{}),this}get fps(){return this._fps}set fps(e){e>this.MAX_FPS?(console.info("Maximum FPS reached: "+this.MAX_FPS),this._fps=this.MAX_FPS):this._fps=e}get cellSize(){return this._cellSize}set cellSize(e){e>this.MAX_CELL_SIZE?(console.info("Maximum Cell Size reached: "+this.MAX_CELL_SIZE),this._cellSize=this.MAX_CELL_SIZE):this._cellSize=e}},y=g;var z=()=>{let c=document.querySelector("#state span"),e=document.querySelector("#fps #target span"),t=document.querySelector("#fps #actual span"),i=document.querySelector("#patterns select"),r=document.getElementById("help"),s=15,u=20,o=document.getElementById("conway-canvas"),a=new y(o,s,u).setHeightOffset(document.querySelector("#info")?.clientHeight??0).init();a.getSupportedPatterns().forEach((n,h)=>{let l=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase();i.add(new Option(l,n,h==0))});let f=n=>({x:n.clientX-o.offsetLeft,y:n.clientY-o.offsetTop}),d=()=>{t.innerHTML=Math.floor(1e3/a.getRealFrameTime()).toString(),setTimeout(d,250)};o.addEventListener("mousedown",n=>{let{x:h,y:l}=f(n);a.showPattern(a.getCurrentPreviewPattern(),h,l)},!1),o.addEventListener("mousemove",n=>{let{x:h,y:l}=f(n);a.showPatternPreview(a.getCurrentPreviewPattern(),h,l)},!1),window.addEventListener("keyup",n=>{switch(n.key.toLowerCase()){case"p":a.setGameState(0);break;case"h":r.open?r.close():r.showModal();break;case" ":a.setGameState(a.currentState==1?0:1);break;default:break}a.currentState==1?e.innerHTML=a.fps.toString():e.innerHTML="0";let l=Object.keys(p)[Object.values(p).indexOf(a.currentState)];document.title="Conway's Game of Life - "+l,c.innerHTML=l},!1),i.addEventListener("change",()=>{let n=i.value,h=m[n]??"Cell";a.setCurrentPreviewPattern(h)}),d()};document.addEventListener("DOMContentLoaded",()=>z());})();
