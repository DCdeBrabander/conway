"use strict";(()=>{var d=class{constructor(e,i,t){this.x=0;this.y=0;this.size=0;this.example=!1;this.alive=!0;this.aliveNeighbours=0;this.setAliveNeighbours=e=>this.aliveNeighbours=e;this.x=e,this.y=i,this.alive=t}},m=d;var y=[[!1,!1,!1,!1,!1],[!1,!0,!0,!0,!1],[!1,!1,!1,!1,!1]],p=y;var N=[[!0]],g=N;var L=[[!1,!1,!0,!1,!1],[!1,!1,!1,!0,!1],[!1,!0,!0,!0,!1]],b=L;var u=(t=>(t.CELL="Cell",t.BLINKER="Blinker",t.GLIDER="Glider",t))(u||{}),E=h=>{switch(h){case"Cell":return g;case"Blinker":return p;case"Glider":return b;default:return[]}};var f=(i=>(i[i.PAUSED=0]="PAUSED",i[i.RUNNING=1]="RUNNING",i))(f||{}),C=class{constructor(e,i=10,t=3){this.theme={grid:"#AAA",cell:{alive:"#FFF",example:"#AAA"},background:"#444"};this.grid=[];this.previewCells=[];this.currentState=0;this.currentPreviewPattern="Cell";this.heightOffset=0;this.init=()=>(this.setGameState(0),this.setCanvasSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",this.onResize,!1),this.grid=this.getNewGrid(),requestAnimationFrame(this.draw),this);this.draw=()=>{this.clear(),this.currentState==1&&this.update(),this.drawPreviewCells(),this.drawLivingCells(),this.drawGrid(),setTimeout(()=>{requestAnimationFrame(this.draw)},1e3/this.fps)};this.update=()=>{let e=this.getNewGrid();this.grid.forEach((i,t)=>{i.forEach((s,r)=>{s.setAliveNeighbours(this.countAliveNeighboursForCell(s)),e[t][r].alive=this.isCellStillAlive(s)})}),this.grid=e};this.clear=()=>{this.canvasContext.fillStyle=this.theme.background,this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.canvasContext.fillRect(0,0,this.canvasElement.width,this.canvasElement.height)};this.onResize=()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.setCanvasSize(window.innerWidth,window.innerHeight),this.init(),console.info("canvas resized and reinitialized")},100)};this.getNewGrid=()=>{let e=[];for(let i=0;i<=this.canvasElement?.width;i+=this.resolution){e[i]=[];for(let t=0;t<=this.canvasElement?.height;t+=this.resolution)e[i][t]=new m(i,t,!1)}return e};this.drawGrid=()=>{this.canvasContext.strokeStyle=this.theme.grid,this.grid.forEach(e=>{e.forEach((i,t)=>{this.canvasContext.strokeRect(i.x,i.y,this.resolution,this.resolution)})})};this.drawPreviewCells=()=>this.previewCells.forEach(e=>e.forEach((i,t)=>this.drawCell(i)));this.drawLivingCells=()=>this.grid.forEach(e=>e.forEach((i,t)=>this.drawCell(i)));this.drawCell=e=>{if(e.alive)this.canvasContext.fillStyle=this.theme.cell.alive;else if(e.example)this.canvasContext.fillStyle=this.theme.cell.example;else return;this.canvasContext.fillRect(e.x,e.y,this.resolution,this.resolution)};this.getCellAt=(e,i)=>this.grid[e][i];this.overflowPosition=(e,i)=>{let t={x:e,y:i},{width:s,height:r}=this.canvasElement;return e<0?t.x=s-this.resolution:e>=s&&(t.x=0),i<0?t.y=r-this.resolution:i>=r&&(t.y=0),t};this.getSupportedPatterns=()=>Object.keys(u);this.getCurrentPreviewPattern=()=>this.currentPreviewPattern;this.setCurrentPreviewPattern=e=>(this.currentPreviewPattern=e,this);this.setHeightOffset=e=>(this.heightOffset=e,this);this.setCanvasSize=(e,i)=>{let t=this.roundToNearest(e),s=this.roundToNearest(i-this.heightOffset);return this.canvasElement.style.width=t+"px",this.canvasElement.style.height=s+"px",this.canvasElement.width=t,this.canvasElement.height=s,this};this.setGameState=e=>(this.currentState=e,this);this.isCellStillAlive=e=>{let i=e.alive;return e.aliveNeighbours=this.countAliveNeighboursForCell(e),e.alive?e.aliveNeighbours===2||e.aliveNeighbours===3?i=!0:i=!1:e.aliveNeighbours===3&&(i=!0),i};this.toggleCellAtCoordinate=(e,i)=>{let t=this.roundToNearest(e),s=this.roundToNearest(i),r=this.getCellAt(t,s);return this.getCellAt(t,s)?(r.alive=!r.alive,this):this};this.countAliveNeighboursForCell=e=>{let i=0,t=this.resolution,{x:s,y:r}=e,a=[this.overflowPosition(s-t,r-t),this.overflowPosition(s,r-t),this.overflowPosition(s+t,r-t),this.overflowPosition(s-t,r),this.overflowPosition(s+t,r),this.overflowPosition(s-t,r+t),this.overflowPosition(s,r+t),this.overflowPosition(s+t,r+t)];for(let n of a)this.getCellAt(n.x,n.y).alive&&i++;return i};this.roundToNearest=(e,i=this.resolution)=>Math.floor(e/i)*i;this.showPattern=(e,i,t,s=!1)=>{let r=E(e),a=[];s?(this.previewCells=this.getNewGrid(),a=this.previewCells):a=this.grid,r.forEach((n,o)=>{n.forEach((l,x)=>{let c=this.roundToNearest(o*this.resolution+i),v=this.roundToNearest(x*this.resolution+t);if(typeof a[c][v]>"u"||!a[c][v]||!l)return;let w=new m(c,v,!s);w.example=s,a[c][v]=w})})};this.showPatternPreview=(e,i,t)=>{this.showPattern(e,i,t,!0)};return this.canvasElement=e,this.canvasContext=this.canvasElement.getContext("2d"),this.resizeTimeout=setTimeout(()=>{}),this.resolution=i,this.fps=t,this}},P=C;var S=()=>{let h=document.getElementById("state"),e=20,i=5,t=document.getElementById("conway-canvas"),s=document.getElementById("patterns"),r=new P(t,e,i).setHeightOffset(document.querySelector("#info")?.clientHeight??0).init();r.getSupportedPatterns().forEach((n,o)=>{let l=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase();s.add(new Option(l,n,o==0))});let a=n=>({x:n.clientX-t.offsetLeft,y:n.clientY-t.offsetTop});t.addEventListener("mousedown",n=>{let{x:o,y:l}=a(n);r.showPattern(r.getCurrentPreviewPattern(),o,l)},!1),t.addEventListener("mousemove",n=>{let{x:o,y:l}=a(n);r.showPatternPreview(r.getCurrentPreviewPattern(),o,l)},!1),window.addEventListener("keyup",n=>{switch(n.key.toLowerCase()){case"p":r.setGameState(0);break;case" ":r.setGameState(r.currentState==1?0:1);break;default:break}let l=Object.keys(f)[Object.values(f).indexOf(r.currentState)];document.title="Conway's Game of Life - "+l,h.innerHTML=l},!1),s.addEventListener("change",()=>{let n=s.value,o=u[n]??"Cell";r.setCurrentPreviewPattern(o)})};document.addEventListener("DOMContentLoaded",()=>S());})();
